[gcode_macro GET_PRINT_FILENAME]
gcode = 
	DYNAMIC_MACRO MACRO=GET_PRINT_FILENAME {rawparams}

[gcode_macro PRE_SCAN_TOOL_CHANGES]
gcode = {% set path = printer.virtual_sdcard.path ~ '/' ~ printer.print_stats.filename %}
	DYNAMIC_MACRO MACRO=PRE_SCAN_TOOL_CHANGES {rawparams}

[gcode_macro SAVE_PRINT_FILE]
variable_print_file = ""
gcode = 
	DYNAMIC_MACRO MACRO=SAVE_PRINT_FILE {rawparams}

[gcode_macro SHOW_TOOL_CHANGE_STATUS]
gcode = 
	DYNAMIC_MACRO MACRO=SHOW_TOOL_CHANGE_STATUS {rawparams}

[gcode_macro TRACK_TOOL_CHANGE]
gcode = 
	DYNAMIC_MACRO MACRO=TRACK_TOOL_CHANGE {rawparams}

[gcode_macro SHOW_TOOL_CHANGE_COLOR]
variable_filament_color = 'None'
gcode = 
	DYNAMIC_MACRO MACRO=SHOW_TOOL_CHANGE_COLOR {rawparams}

[gcode_macro SHOW_PROMT_BUTTON_GROUPS]
gcode = 
	DYNAMIC_MACRO MACRO=SHOW_PROMT_BUTTON_GROUPS {rawparams}

[gcode_macro PYFILE]
gcode = 
	DYNAMIC_MACRO MACRO=PYFILE {rawparams}

[gcode_macro SEARCH_VARS]
gcode = {% set resultcount = namespace(total=0) %}
	{% set search = params.S|lower %}
	{% set ns = namespace() %}
	{% set ns.path = ['printer', "['%s']" % (item), ''] %}
	{% set ns.path = ['printer.', item, ''] %}
	{% set resultcount.total = 1 + resultcount.total %}
	{% set ns.path = ns.path[:loop.depth|int + 1] %}
	{% set null = ns.path.append("['%s']" % (childkey)) %}
	{% set null = ns.path.append(".%s" % (childkey)) %}
	{% set resultcount.total = 1 + resultcount.total %}
	{% set resultcount.total = 0|int %}
	DYNAMIC_MACRO MACRO=SEARCH_VARS {rawparams}

[gcode_macro FILAMENT_SWAP_PROMPT]
gcode = 
	DYNAMIC_MACRO MACRO=FILAMENT_SWAP_PROMPT {rawparams}

[gcode_macro CLOSE_PROMPT_AND_RESUME]
gcode = 
	DYNAMIC_MACRO MACRO=CLOSE_PROMPT_AND_RESUME {rawparams}

[gcode_macro test_color]
gcode = 
	DYNAMIC_MACRO MACRO=test_color {rawparams}

[gcode_macro m300]
description = Emits and audible beep.
	
	Usage: M300 [P<duration>] [S<frequency>]
gcode = {% set settings = printer.configfile.settings %}
	{% set P = (params.P|default(100)|int, 0)|max %}
	{% set S = (params.S|default(1000)|int, 1)|max %}
	DYNAMIC_MACRO MACRO=m300 {rawparams}

[gcode_macro _km_beep_if_available]
description = Wraps beeper to avoid console spam
gcode = 
	DYNAMIC_MACRO MACRO=_km_beep_if_available {rawparams}

[gcode_macro PROBE_FEELER]
gcode = {% set FEELER_THICKNESS = params.THICKNESS|default(0.1)|float %}
	DYNAMIC_MACRO MACRO=PROBE_FEELER {rawparams}

[gcode_macro APPLY_Z_FEELER_OFFSET]
gcode = {% set svv = printer.save_variables.variables %}
	DYNAMIC_MACRO MACRO=APPLY_Z_FEELER_OFFSET {rawparams}

[gcode_macro START_PRINT]
gcode = {% set BED_TEMP = params.BED_TEMP|default(60)|float %}
	{% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(210)|float %}
	{% set EXTRUDER_STANDBY_TEMP = EXTRUDER_TEMP - 30 %}
	DYNAMIC_MACRO MACRO=START_PRINT {rawparams}

[gcode_macro END_PRINT]
variable_machine_depth = 235
gcode = 
	DYNAMIC_MACRO MACRO=END_PRINT {rawparams}

[gcode_macro M600]
gcode = {% set current_temp = printer.extruder.target %}
	DYNAMIC_MACRO MACRO=M600 {rawparams}

[gcode_macro SAVE_FILAMENT_SENSOR_STATE]
description = Save the current enabled state of filament
variable_encoder_state = -1
variable_switch_state = -1
gcode = {% set encoder_enabled = printer['filament_motion_sensor encoder_sensor'].enabled %}
	{% set switch_enabled = printer['filament_switch_sensor switch_sensor'].enabled %}
	DYNAMIC_MACRO MACRO=SAVE_FILAMENT_SENSOR_STATE {rawparams}

[gcode_macro RESTORE_FILAMENT_SENSOR_STATE]
description = Restore the previously saved filament sensor states
gcode = {% set encoder_state = printer['gcode_macro SAVE_FILAMENT_SENSOR_STATE'].encoder_state %}
	{% set switch_state = printer['gcode_macro SAVE_FILAMENT_SENSOR_STATE'].switch_state %}
	DYNAMIC_MACRO MACRO=RESTORE_FILAMENT_SENSOR_STATE {rawparams}

[gcode_macro GET_FILAMENT_SENSOR_STATE]
description = Display the currently saved filament sensor states
gcode = {% set encoder_state = printer['gcode_macro SAVE_FILAMENT_SENSOR_STATE'].encoder_state %}
	{% set switch_state = printer['gcode_macro SAVE_FILAMENT_SENSOR_STATE'].switch_state %}
	DYNAMIC_MACRO MACRO=GET_FILAMENT_SENSOR_STATE {rawparams}

[gcode_macro LOAD_FILAMENT]
variable_load_distance = 40
variable_purge_distance = 50
variable_nozzle_preheat_temp = 220
variable_retract_distance = 0
variable_turn_off_extruder = False
gcode = {% set load_speed = params.LOAD_SPEED|default(600) %}
	{% set purge_speed = params.PURGE_SPEED|default(300) %}
	{% set target_temp = params.TARGET_TEMP|default(nozzle_preheat_temp) %}
	{% set retract = params.RETRACT|default(retract_distance)|float %}
	{% set min_temp = params.MIN_TEMP|default(180) %}
	DYNAMIC_MACRO MACRO=LOAD_FILAMENT {rawparams}

[gcode_macro COLOR_TRACKER]
variable_next_color = "Black"
variable_total_changes = 5
variable_current_change = 4
variable_remaining_changes = 1
gcode = 
	DYNAMIC_MACRO MACRO=COLOR_TRACKER {rawparams}

[gcode_macro AXEL_FOLEY]
gcode = 
	DYNAMIC_MACRO MACRO=AXEL_FOLEY {rawparams}

[gcode_macro MISSION_IMPOSSIBLE]
gcode = 
	DYNAMIC_MACRO MACRO=MISSION_IMPOSSIBLE {rawparams}

[gcode_macro final_countdown]
gcode = 
	DYNAMIC_MACRO MACRO=final_countdown {rawparams}

[gcode_macro MARIO_TIME]
gcode = {% set count = 2637.02%}
	{% set cytime = 1 / count %}
	{% set count = 2637.02%}
	{% set cytime = 1 / count %}
	{% set count = 2637.02%}
	{% set cytime = 1 / count %}
	{% set count = 2093%}
	{% set cytime = 1 / count %}
	{% set count = 2637.02%}
	{% set cytime = 1 / count %}
	{% set count = 3135.96%}
	{% set cytime = 1 / count %}
	{% set count = 1567.98%}
	{% set cytime = 1 / count %}
	{% set count = 2093%}
	{% set cytime = 1 / count %}
	{% set count = 1567.98%}
	{% set cytime = 1 / count %}
	{% set count = 1318.51%}
	{% set cytime = 1 / count %}
	{% set count = 1760%}
	{% set cytime = 1 / count %}
	{% set count = 1975.53%}
	{% set cytime = 1 / count %}
	{% set count = 1864.66%}
	{% set cytime = 1 / count %}
	{% set count = 1760%}
	{% set cytime = 1 / count %}
	{% set count = 1567.98%}
	{% set cytime = 1 / count %}
	{% set count = 2637.02%}
	{% set cytime = 1 / count %}
	{% set count = 3135.96%}
	{% set cytime = 1 / count %}
	{% set count = 3520%}
	{% set cytime = 1 / count %}
	{% set count = 2793.83%}
	{% set cytime = 1 / count %}
	{% set count = 3135.96%}
	{% set cytime = 1 / count %}
	{% set count = 2637.02%}
	{% set cytime = 1 / count %}
	{% set count = 2093%}
	{% set cytime = 1 / count %}
	{% set count = 2349.32%}
	{% set cytime = 1 / count %}
	{% set count = 1975.53%}
	{% set cytime = 1 / count %}
	{% set count = 2637.02%}
	{% set cytime = 1 / count %}
	{% set count = 2093%}
	{% set cytime = 1 / count %}
	{% set count = 1567.98%}
	{% set cytime = 1 / count %}
	{% set count = 1661.22%}
	{% set cytime = 1 / count %}
	{% set count = 1760%}
	{% set cytime = 1 / count %}
	{% set count = 2793.83%}
	{% set cytime = 1 / count %}
	{% set count = 2793.83%}
	{% set cytime = 1 / count %}
	{% set count = 1760%}
	{% set cytime = 1 / count %}
	{% set count = 1567.98%}
	{% set cytime = 1 / count %}
	{% set count = 3520%}
	{% set cytime = 1 / count %}
	{% set count = 3520%}
	{% set cytime = 1 / count %}
	{% set count = 3520%}
	{% set cytime = 1 / count %}
	{% set count = 3135.96%}
	{% set cytime = 1 / count %}
	{% set count = 2793.83%}
	{% set cytime = 1 / count %}
	{% set count = 2637.02%}
	{% set cytime = 1 / count %}
	{% set count = 2093%}
	{% set cytime = 1 / count %}
	{% set count = 1760%}
	{% set cytime = 1 / count %}
	{% set count = 1567.98%}
	{% set cytime = 1 / count %}
	{% set count = 2637.02%}
	{% set cytime = 1 / count %}
	{% set count = 2093%}
	{% set cytime = 1 / count %}
	{% set count = 1567.98%}
	{% set cytime = 1 / count %}
	{% set count = 1661.22%}
	{% set cytime = 1 / count %}
	{% set count = 1760%}
	{% set cytime = 1 / count %}
	{% set count = 2793.83%}
	{% set cytime = 1 / count %}
	{% set count = 2793.83%}
	{% set cytime = 1 / count %}
	{% set count = 1760%}
	{% set cytime = 1 / count %}
	{% set count = 1975.53%}
	{% set cytime = 1 / count %}
	{% set count = 2793.83%}
	{% set cytime = 1 / count %}
	{% set count = 2793.83%}
	{% set cytime = 1 / count %}
	{% set count = 2793.83%}
	{% set cytime = 1 / count %}
	{% set count = 2637.02%}
	{% set cytime = 1 / count %}
	{% set count = 2349.32%}
	{% set cytime = 1 / count %}
	{% set count = 2093%}
	{% set cytime = 1 / count %}
	DYNAMIC_MACRO MACRO=MARIO_TIME {rawparams}

[gcode_macro frequency_sweep]
description = Frequency sweep across the 4th to 8th octaves at double speed.
gcode = 
	DYNAMIC_MACRO MACRO=frequency_sweep {rawparams}

